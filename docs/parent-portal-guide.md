# 家长门户使用指南

## 概述

家长门户允许家长监控孩子的大学申请进度，查看申请详情，并与孩子进行沟通。

## 主要功能

### 1. 家长仪表板 (`/parent/dashboard`)
- **申请统计**: 显示所有学生的申请进度统计概览
- **学术档案**: 显示孩子的学术信息（GPA、SAT/ACT分数、目标国家、专业等）
- **申请表格**: 显示所有孩子的申请列表，可点击查看详情
- **首次登录模态框**: 自动弹出提示关联学生账户

### 2. 我的学生 (`/parent/manage-students`)
- **学生列表**: 显示所有已关联的学生卡片
- **添加学生**: 通过模态框添加新的学生账户
- **移除学生**: 可以移除与学生的关联关系
- **查看申请**: 点击学生卡片查看详细申请列表

### 3. 学生申请列表 (`/parent/students/[studentId]/applications`)
- **申请概览**: 显示特定学生的所有申请
- **状态跟踪**: 实时查看申请状态变化
- **截止日期提醒**: 突出显示即将到期的申请

### 4. 申请详情页面 (`/parent/applications/[id]`)
- **只读视图**: 查看申请的所有详细信息
- **状态信息**: 申请状态、类型、截止日期等
- **学生笔记**: 查看学生添加的笔记
- **发送通知**: 向学生发送消息和提醒
- **大学信息**: 显示大学排名、录取率等详细信息
- **申请时间线**: 显示申请进度的时间线

### 5. 大学浏览 (`/parent/universities`)
- **大学搜索**: 浏览和搜索所有大学
- **筛选功能**: 按国家、州、排名、录取率等筛选
- **分页浏览**: 支持分页查看大学列表
- **详细信息**: 查看大学的详细信息

### 6. 通知系统
- **通知铃铛**: 右上角显示未读通知数量
- **消息预览**: 悬停查看最新通知
- **学生回复**: 查看学生对家长消息的回复

## 权限说明

### 家长权限
- ✅ 查看关联学生的所有申请
- ✅ 查看申请详情和进度
- ✅ 向学生发送消息和提醒
- ✅ 查看学生笔记和状态更新
- ❌ 无法修改申请信息
- ❌ 无法编辑学生资料

### 数据访问
- 只能查看通过 `parent_links` 表关联的学生数据
- 所有操作都有权限验证，确保数据安全

## 使用流程

### 1. 注册和登录
1. 访问注册页面，选择"Parent"角色
2. 填写个人信息并创建账户
3. 登录后自动跳转到家长仪表板

### 2. 关联学生账户
1. 首次登录时会弹出模态框提示关联学生
2. 输入孩子的学生账户邮箱
3. 系统搜索并显示找到的学生账户
4. 点击"Link"关联账户
5. 可以随时在"Manage Students"页面添加更多学生

### 3. 查看孩子数据
1. 在家长仪表板查看申请统计概览
2. 查看孩子的学术档案信息
3. 浏览所有申请列表

### 4. 管理学生
1. 在"My Students"页面查看所有关联学生
2. 点击"Add Student"添加新学生
3. 点击"Remove"移除学生关联
4. 点击学生卡片查看申请列表

### 5. 查看学生进度
1. 在"My Students"页面点击学生卡片
2. 查看学生的申请列表和统计
3. 监控申请状态和截止日期

### 6. 监控申请详情
1. 在仪表板或申请列表中点击具体申请
2. 查看申请状态、截止日期、大学信息
3. 阅读学生添加的笔记
4. 查看申请时间线和大学详细信息

### 7. 与学生沟通
1. 在申请详情页面找到"Send Note to Student"
2. 编写消息并发送
3. 学生将在通知中收到消息

## 技术实现

### 数据库关系
```sql
-- 家长-学生关联表
parent_links (
  parent_user_id UUID REFERENCES profiles(user_id),
  student_user_id UUID REFERENCES profiles(user_id),
  PRIMARY KEY (parent_user_id, student_user_id)
)

-- 家长笔记表
parent_notes (
  id UUID PRIMARY KEY,
  application_id UUID REFERENCES applications(id),
  parent_user_id UUID REFERENCES profiles(user_id),
  note TEXT,
  created_at TIMESTAMP
)
```

### 权限验证
- 所有API端点都验证家长身份
- 检查 `parent_links` 表确保访问权限
- 防止跨用户数据访问

### 组件结构
```
components/
├── parent/
│   └── ParentOverview.tsx          # 家长概览统计
├── layouts/
│   ├── DashboardLayout.tsx         # 动态侧边栏
│   └── ParentNotificationsBell.tsx # 家长通知铃铛
└── auth/
    └── SignupCard.tsx              # 支持角色选择
```

## 安全考虑

1. **角色验证**: 中间件确保家长无法访问学生路由
2. **数据隔离**: 只能查看关联学生的数据
3. **API保护**: 所有端点都有权限检查
4. **会话管理**: 支持账户切换和登出

## 未来扩展

- [ ] 家长可以查看学生的学术资料
- [ ] 支持家长设置提醒和通知偏好
- [ ] 添加申请进度图表和趋势分析
- [ ] 支持家长和学生之间的实时聊天
- [ ] 添加申请费用跟踪功能 